<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ibonarium Real-Time</title>
<style>
body { margin:0; font-family:"Courier New", monospace; background:#0a0a0a; color:#9fe7ff; display:flex; flex-direction:column; align-items:center; padding:20px; }
h1 { text-align:center; margin-bottom:20px; }
.heatmap { display:grid; grid-template-columns:repeat(2, 400px); gap:15px; width:100%; max-width:900px; }
.card { padding:15px; border-radius:10px; text-align:center; color:#000; font-weight:bold; font-size:14px; transition:0.5s; }
.value { font-size:18px; margin-top:5px; }
#systemStatus { margin-top:20px; font-size:20px; font-weight:bold; }
</style>
</head>
<body>
<h1>Ibonarium Real-Time - –ï–∫–æ–ª–æ–≥—ñ—è</h1>
<div class="heatmap" id="heatmap"></div>
<div id="systemStatus">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>

<script>
const indicators = [
  {id:'pm25', label:'PM2.5', api:'https://api.openaq.org/v2/latest?parameter=pm25&limit=1000', value:0, thresholds:[35,55]},
  {id:'pm10', label:'PM10', api:'https://api.openaq.org/v2/latest?parameter=pm10&limit=1000', value:0, thresholds:[50,100]},
  {id:'no2', label:'NO2', api:'https://api.openaq.org/v2/latest?parameter=no2&limit=1000', value:0, thresholds:[40,80]},
  {id:'o3', label:'O3', api:'https://api.openaq.org/v2/latest?parameter=o3&limit=1000', value:0, thresholds:[60,120]},
  {id:'quakes', label:'–ó–µ–º–ª–µ—Ç—Ä—É—Å–∏ >M4 (–∑–∞ –≥–æ–¥–∏–Ω—É)', api:'https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.0_hour.geojson', value:0, thresholds:[2,5]},
  {id:'volcanoes', label:'–ê–∫—Ç–∏–≤–Ω—ñ –≤—É–ª–∫–∞–Ω–∏', api:'https://volcano.si.edu/news/WeeklyVolcanoRSS.xml', value:0, thresholds:[1,3]},
  {id:'fires', label:'–ü–æ–∂–µ–∂—ñ (NASA FIRMS)', api:'https://firms.modaps.eosdis.nasa.gov/active_fire/c6/csv/MODIS_C6_Global_24h.csv', value:0, thresholds:[10,30]}
];

const heatmap = document.getElementById('heatmap');

function createCards() {
  indicators.forEach(ind=>{
    const div = document.createElement('div');
    div.className='card';
    div.id=ind.id;
    div.innerHTML=`${ind.label}<div class="value">Loading...</div>`;
    heatmap.appendChild(div);
  });
}

function updateCard(indicator) {
  const el = document.getElementById(indicator.id);
  const valEl = el.querySelector('.value');
  valEl.textContent = indicator.value;
  if(indicator.value < indicator.thresholds[0]) el.style.backgroundColor='#4dd2ff'; // –∑–µ–ª–µ–Ω–∏–π
  else if(indicator.value < indicator.thresholds[1]) el.style.backgroundColor='#ffcc00'; // –∂–æ–≤—Ç–∏–π
  else el.style.backgroundColor='#ff4d4d'; // —á–µ—Ä–≤–æ–Ω–∏–π
}

async function fetchData() {
  for(const ind of indicators){
    try{
      if(ind.api.includes('openaq')){
        const res = await fetch(ind.api);
        const data = await res.json();
        const values = data.results.map(r=>r.measurements[0]?.value||0);
        ind.value = Math.round(values.reduce((a,b)=>a+b,0)/values.length);
      } else if(ind.id==='quakes'){
        const res = await fetch(ind.api);
        const data = await res.json();
        ind.value = data.features.length;
      } else if(ind.id==='volcanoes'){
        // XML feed –Ω–µ –º–æ–∂–Ω–∞ –Ω–∞–ø—Ä—è–º—É –ø–∞—Ä—Å–∏—Ç–∏ –Ω–∞ GitHub Pages —á–µ—Ä–µ–∑ CORS
        ind.value = 'N/A';
      } else if(ind.id==='fires'){
        // CSV –∑ NASA FIRMS ‚Äî –Ω–µ–º–æ–∂–ª–∏–≤–æ fetch –±–µ–∑ –ø—Ä–æ–∫—Å—ñ, –ø–æ–∫–∏ N/A
        ind.value = 'N/A';
      }
      updateCard(ind);
    }catch(e){ console.error('–ü–æ–º–∏–ª–∫–∞ fetch',ind.id,e); ind.value='N/A'; updateCard(ind);}
  }
  updateSystemStatus();
}

function updateSystemStatus(){
  let numericValues = indicators.filter(i=>typeof i.value==='number').map(i=>i.value);
  const avg = numericValues.reduce((a,b)=>a+b,0)/numericValues.length;
  const status = document.getElementById('systemStatus');
  if(avg<50) status.textContent='–°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±—ñ–ª—å–Ω–∞ ‚úÖ';
  else if(avg<100) status.textContent='–ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è ‚ö†Ô∏è';
  else status.textContent='–ö—Ä–∏—Ç–∏—á–Ω–∏–π —Å—Ç–∞–Ω üö®';
}

createCards();
fetchData();
setInterval(fetchData,300000); // –∫–æ–∂–Ω—ñ 5 —Ö–≤
</script>
</body>
</html>
