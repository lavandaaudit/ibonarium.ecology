<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ibonarium Heatmap</title>
<style>
body {
  margin:0; font-family:"Courier New", monospace; background:#0a0a0a; color:#9fe7ff;
  display:flex; flex-direction:column; align-items:center; padding:20px;
}
h1 { text-align:center; margin-bottom:20px; }
.heatmap { display:grid; grid-template-columns:repeat(4,200px); gap:15px; width:100%; max-width:900px; }
.card {
  padding:15px; border-radius:10px; text-align:center;
  color:#000; font-weight:bold; font-size:14px; transition:0.5s;
}
.value { font-size:18px; margin-top:5px; }
#systemStatus { margin-top:20px; font-size:20px; font-weight:bold; }
</style>
</head>
<body>
<h1>Ibonarium Heatmap - –ï–∫–æ–ª–æ–≥—ñ—á–Ω–∏–π –û—Å—ñ–Ω—Ç</h1>
<div class="heatmap" id="heatmap">
  <!-- –∫–∞—Ä—Ç–∏ —Å—Ç–≤–æ—Ä—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
</div>
<div id="systemStatus">Loading...</div>

<script>
const indicators = [
  {id:'aqi', label:'AQI (PM2.5)', api:'https://api.openaq.org/v2/latest?parameter=pm25&limit=1000', value:0, thresholds:[50,100]},
  {id:'pm10', label:'PM10', api:'https://api.openaq.org/v2/latest?parameter=pm10&limit=1000', value:0, thresholds:[50,100]},
  {id:'co2', label:'CO2 (ppm)', api:null, value:420, thresholds:[420,450]},
  {id:'ch4', label:'CH4 (ppb)', api:null, value:1890, thresholds:[1800,2000]},
  {id:'temp', label:'–¢–µ–º–ø. –∞–Ω–æ–º–∞–ª—ñ—è ¬∞C', api:null, value:1.2, thresholds:[1,2]},
  {id:'fires', label:'–ê–∫—Ç–∏–≤–Ω—ñ –ø–æ–∂–µ–∂—ñ', api:null, value:0, thresholds:[10,30]},
  {id:'floods', label:'–ü–æ–≤–µ–Ω—ñ', api:null, value:0, thresholds:[5,15]},
  {id:'quakes', label:'–ó–µ–º–ª–µ—Ç—Ä—É—Å–∏ >M4', api:'https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.0_hour.geojson', value:0, thresholds:[2,5]},
  {id:'volcanoes', label:'–í—É–ª–∫–∞–Ω–∏', api:null, value:0, thresholds:[1,3]},
  {id:'deforest', label:'–î–µ—Ñ–æ—Ä–µ—Å—Ç–∞—Ü—ñ—è (ha)', api:null, value:0, thresholds:[200,500]},
  {id:'so2', label:'SO2 (¬µg/m¬≥)', api:null, value:0, thresholds:[20,50]},
  {id:'no2', label:'NO2 (¬µg/m¬≥)', api:'https://api.openaq.org/v2/latest?parameter=no2&limit=1000', value:0, thresholds:[40,80]},
  {id:'o3', label:'O3 (¬µg/m¬≥)', api:'https://api.openaq.org/v2/latest?parameter=o3&limit=1000', value:0, thresholds:[60,120]},
  {id:'pm25-global', label:'PM2.5 –≥–ª–æ–±–∞–ª—å–Ω–æ', api:null, value:0, thresholds:[35,55]},
  {id:'radiation', label:'–†–∞–¥—ñ–∞—Ü—ñ–π–Ω–∏–π —Ñ–æ–Ω', api:null, value:0, thresholds:[0.1,0.3]},
  {id:'humidity', label:'–í–æ–ª–æ–≥—ñ—Å—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–æ %', api:null, value:50, thresholds:[30,70]}
];

const heatmap = document.getElementById('heatmap');

function createCards() {
  indicators.forEach(ind=>{
    const div = document.createElement('div');
    div.className='card';
    div.id=ind.id;
    div.innerHTML=`${ind.label}<div class="value">Loading...</div>`;
    heatmap.appendChild(div);
  });
}

function updateCard(indicator) {
  const el = document.getElementById(indicator.id);
  const valEl = el.querySelector('.value');
  valEl.textContent = indicator.value;
  if(indicator.value < indicator.thresholds[0]) el.style.backgroundColor='#4dd2ff'; // –∑–µ–ª–µ–Ω–∏–π
  else if(indicator.value < indicator.thresholds[1]) el.style.backgroundColor='#ffcc00'; // –∂–æ–≤—Ç–∏–π
  else el.style.backgroundColor='#ff4d4d'; // —á–µ—Ä–≤–æ–Ω–∏–π
}

async function fetchData() {
  for(const ind of indicators){
    try{
      if(ind.api){
        const res = await fetch(ind.api);
        const data = await res.json();
        if(ind.id==='aqi'){
          const values = data.results.map(r=>r.measurements[0]?.value||0);
          ind.value = Math.round(values.reduce((a,b)=>a+b,0)/values.length);
        } else if(ind.id==='pm10'){
          const values = data.results.map(r=>r.measurements[0]?.value||0);
          ind.value = Math.round(values.reduce((a,b)=>a+b,0)/values.length);
        } else if(ind.id==='quakes'){
          ind.value = data.features.length;
        } else if(ind.id==='no2'){
          const values = data.results.map(r=>r.measurements[0]?.value||0);
          ind.value = Math.round(values.reduce((a,b)=>a+b,0)/values.length);
        } else if(ind.id==='o3'){
          const values = data.results.map(r=>r.measurements[0]?.value||0);
          ind.value = Math.round(values.reduce((a,b)=>a+b,0)/values.length);
        }
      } else {
        // —Å–∏–º—É–ª—è—Ü—ñ—è –¥–ª—è —ñ–Ω—à–∏—Ö –¥–∞–Ω–∏—Ö
        ind.value = Math.round(ind.thresholds[0]*Math.random()*1.5 + ind.thresholds[0]);
      }
      updateCard(ind);
    }catch(e){ console.error('–ü–æ–º–∏–ª–∫–∞ fetch',ind.id,e);}
  }
  updateSystemStatus();
}

function updateSystemStatus(){
  const avg = indicators.reduce((a,b)=>a+b.value,0)/indicators.length;
  const status = document.getElementById('systemStatus');
  if(avg<50) status.textContent='–°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±—ñ–ª—å–Ω–∞ ‚úÖ';
  else if(avg<100) status.textContent='–ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è ‚ö†Ô∏è';
  else status.textContent='–ö—Ä–∏—Ç–∏—á–Ω–∏–π —Å—Ç–∞–Ω üö®';
}

createCards();
fetchData();
setInterval(fetchData,300000); // –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 5 —Ö–≤
</script>
</body>
</html>
