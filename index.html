<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ibonarium Real-Time</title>
<style>
body { margin:0; font-family:"Courier New", monospace; background:#0a0a0a; color:#9fe7ff; display:flex; flex-direction:column; align-items:center; padding:20px; }
h1 { text-align:center; margin-bottom:20px; }
.heatmap { display:grid; grid-template-columns:repeat(2, 300px); gap:15px; width:100%; max-width:650px; }
.card { padding:15px; border-radius:10px; text-align:center; color:#000; font-weight:bold; font-size:14px; transition:0.5s; }
.value { font-size:18px; margin-top:5px; }
#systemStatus { margin-top:20px; font-size:20px; font-weight:bold; color:#fff; }
</style>
</head>
<body>
<h1>Ibonarium Real-Time - –ï–∫–æ–ª–æ–≥—ñ—è</h1>
<div class="heatmap" id="heatmap"></div>
<div id="systemStatus">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...</div>

<script>
const serverBase = "https://YOUR_SERVER_URL"; // <- —Å—é–¥–∏ –≤—Å—Ç–∞–≤ —Å–≤—ñ–π Render/Railway URL

const indicators = [
  {id:'pm25', label:'PM2.5', value:0, thresholds:[35,55]},
  {id:'pm10', label:'PM10', value:0, thresholds:[50,100]},
  {id:'no2', label:'NO2', value:0, thresholds:[40,80]},
  {id:'o3', label:'O3', value:0, thresholds:[60,120]},
  {id:'quakes', label:'–ó–µ–º–ª–µ—Ç—Ä—É—Å–∏ >M4 (–∑–∞ –≥–æ–¥–∏–Ω—É)', value:0, thresholds:[2,5]}
];

const heatmap = document.getElementById('heatmap');

function createCards() {
  indicators.forEach(ind=>{
    const div = document.createElement('div');
    div.className='card';
    div.id=ind.id;
    div.innerHTML=`${ind.label}<div class="value">Loading...</div>`;
    heatmap.appendChild(div);
  });
}

function updateCard(ind) {
  const el = document.getElementById(ind.id);
  const valEl = el.querySelector('.value');
  valEl.textContent = ind.value;
  if(typeof ind.value==='number'){
    if(ind.value < ind.thresholds[0]) el.style.backgroundColor='#4dd2ff';
    else if(ind.value < ind.thresholds[1]) el.style.backgroundColor='#ffcc00';
    else el.style.backgroundColor='#ff4d4d';
  } else el.style.backgroundColor='#666';
}

async function fetchData() {
  try{
    // –ü–æ–≤—ñ—Ç—Ä—è
    const air = await fetch(`${serverBase}/api/air`).then(r=>r.json());
    indicators[0].value = Math.round(air.pm25.results.reduce((a,b)=>a+b.measurements[0].value,0)/air.pm25.results.length);
    indicators[1].value = Math.round(air.pm10.results.reduce((a,b)=>a+b.measurements[0].value,0)/air.pm10.results.length);
    indicators[2].value = Math.round(air.no2.results.reduce((a,b)=>a+b.measurements[0].value,0)/air.no2.results.length);
    indicators[3].value = Math.round(air.o3.results.reduce((a,b)=>a+b.measurements[0].value,0)/air.o3.results.length);

    // –ó–µ–º–ª–µ—Ç—Ä—É—Å–∏
    const quakes = await fetch(`${serverBase}/api/quakes`).then(r=>r.json());
    indicators[4].value = quakes.features.length;

    indicators.forEach(updateCard);
    updateSystemStatus();
  } catch(e){ console.error(e); }
}

function updateSystemStatus(){
  let numericValues = indicators.filter(i=>typeof i.value==='number').map(i=>i.value);
  if(numericValues.length===0) {document.getElementById('systemStatus').textContent='–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö ‚ùå'; return;}
  const avg = numericValues.reduce((a,b)=>a+b,0)/numericValues.length;
  const status = document.getElementById('systemStatus');
  if(avg<50) status.textContent='–°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±—ñ–ª—å–Ω–∞ ‚úÖ';
  else if(avg<100) status.textContent='–ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è ‚ö†Ô∏è';
  else status.textContent='–ö—Ä–∏—Ç–∏—á–Ω–∏–π —Å—Ç–∞–Ω üö®';
}

createCards();
fetchData();
setInterval(fetchData,300000);
</script>
</body>
</html>
